<!DOCTYPE html>
<html lang="zh_CN" xmlns:th="http://www.thymeleaf.org"
	xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<meta charset="utf-8">
<link rel="stylesheet" href="/css/list/gm.css">
<link rel="stylesheet" href="/css/form/comment.css">
<link rel="stylesheet" href="/css/workflow/flowChart.css">
<head th:include="include::formHeaderContent"></head>

<body class="windowPage layer-body" th:classappend="${session.theme}">
	
	<form action="" id="operate">
		<div class="layer-box">
			<div id="hideParam">
				<input type="hidden" id="data" th:value="${data}"/>
				<input type="hidden" id="type" name="type"/>
				<input type="hidden" id="objectType" name="objectType" th:value="${objectType}"/>
				<input type="hidden" id="speciData" name="speciData" th:value="${speciData}"/>
				<input type="hidden" id="pageTitle" name="pageTitle" th:value="${pageTitle}"/>
				<input type="hidden" id="objectId" name="objectId" th:value="${objectId}">
				<input type="hidden" id="transitionId" name="transitionId" th:value="${transitionId}">
				<input type="hidden" id="workflowId" name="workflowId" th:value="${workflowId}">
				<input type="hidden" id="rejectOp" name="rejectOp" th:value="Y">
			</div>
			
			<div class="layout-box new">
				<div class="layout-left">
					<ul class="page-ul"></ul>
					<div class="formBtn hide">
						<div class="layui-layer-btn layui-submit-btn">
							<input type="submit" class="layui-layer-btn0 btns cp" id="confirmBtn" th:value="确定"/>
							<a class="layui-layer-btn1 close-btn cp" th:text="#{common.cancel}" onclick="tabReturnBack($(this))"></a>
						</div>
					</div>
				</div>
			</div>
		</div>
	</form>
	
	<div th:include="include::formFooterContent"></div>
	<script src="/js/list/jquery.ui.widget.min.js"></script>
	<script src="/js/form/comment.js"></script>
	<script src="/js/list/gm.js"></script>
	<script src="/js/list/list.table.js"></script>
	<script src="/js/list/list.filter.js"></script>
	<script th:inline="javascript"> var ctx = [[@{/}]], parentName = [[${param.parentname}]];</script>
	
	<script>
		var objectType = $('#objectType').val();
		$(function() {
			var data = $('#data').val();
			if(!data) {
				$('#confirmBtn').hide();
			}
			initFormList(data);
			initFormControl(objectType);
			$('.formBtn').removeClass('hide');
			$('.summernote').each(function() {
				$(this).summernote('code', $(this).prev().val());
			});
			
			var hasSave = $('#hasSave').val();
			if(hasSave && hasSave == 'Y') {
				$('#confirmBtn').hide();
			}
			
			$("#operate").html5Validate(function() {
				onlySaveData();
			}, {
				validate: function() {
					return customValidate(objectType);
				}
			});
		});
		
		function onlySaveData() {
			$.ajax({
				cache : true,
				type : "POST",
				url : "/workflow/skipAnyNode",
				data : $('#operate').serialize_plus(),// 你的formid
				async : false,
				success : function(data) {
					if (data.code == 0) {
						if(parentName && parentName[0]) {
							var parentFrame = top.frames[parentName[0]];
							if(parentFrame && typeof parentFrame.returnBackAndReLoad== "function") {
								parentFrame.returnBackAndReLoad(true);
							}
						}else{
							hideLoading();
							returnBackAndReLoad();
						}
						parent.layer.msg(data.msg);
					} else {
						parent.layer.msg(data.msg, 1);
					}
					
					hideLoading();
				}
			});
		}
	</script>
	
</body>
</html>